package com.skilldistillery.cards.blackjack;

import java.util.Scanner;

import com.skilldistillery.cards.players.Dealer;
import com.skilldistillery.cards.players.Player;
import com.skilldistillery.cards.players.UserPlayer;

public class GameDriver {

	public static void main(String[] args) {
		playGame();
	}

	public static void playGame() {
		Scanner kb = new Scanner(System.in);
		String entry = "";
		String dealerEntry = "";
		Dealer dealer = new Dealer();
		Player user = new UserPlayer();

		dealer.Shuffle();

		dealer.deal(user, dealer);
		
		printBothHands(user, dealer);

		outer: do {
			// Game loop to determine if user has decided to stay
			do {

				System.out.println();
				System.out.println("Would you like to hit or stay?");
				entry = kb.next();
				if (!entry.equalsIgnoreCase("hit") && !entry.equalsIgnoreCase("stay")) {
					System.out.println("Please choose either hit or stay.");
				} else if (entry.equalsIgnoreCase("hit")) {
					user.setHand(dealer.hit());
					if (user.getTotal() > 21) {
						printUserHand();
						break outer;
					}
					System.out.println("User hand: " + user.getHand().toString());
					System.out.println("Your current total: " + user.getTotal());

				} else {
					System.out.println("You've decided to stay.");
					System.out.println("User hand: " + user.getHand().toString());
					System.out.println("Your current total: " + user.getTotal());
					System.out.println("Dealer's hand: " + dealer.getHand().toString());
					System.out.println("Dealer's current total: " + dealer.getTotal());

				}

			} while (entry.equalsIgnoreCase("hit"));

			do {
				dealerEntry = dealer.determineWhatToDo();

				if (dealerEntry.equals("hit")) {
					dealer.setHand(dealer.hit());
					if (dealer.getTotal() > 21) {
						System.out.println("User hand: " + user.getHand().toString());
						System.out.println("Your current total: " + user.getTotal());
						System.out.println("Dealer's hand: " + dealer.getHand().toString());
						System.out.println("Dealer's current total: " + dealer.getTotal());
						break outer;
					}
				}

				System.out.println();
				System.out.println("Dealer decided to " + dealerEntry);
				System.out.println();
				System.out.println("User hand: " + user.getHand().toString());
				System.out.println("Your current total: " + user.getTotal());
				System.out.println("Dealer's hand: " + dealer.getHand().toString());
				System.out.println("Dealer's current total: " + dealer.getTotal());

			} while (dealerEntry.equals("hit"));

		} while ((user.getTotal() < 21 && dealer.getTotal() < 21)
				&& (entry.equalsIgnoreCase("hit") && dealerEntry.equals("hit")));

		winCheck(user, dealer);
	}

	public static void printBothHands(Player user, Player dealer) {
		System.out.println("User hand: " + user.getHand().toString());
		System.out.println("Your current total: " + user.getTotal());
		System.out.println("Dealer's hand: " + dealer.getHand().toString());
		System.out.println("Dealer's current total: " + dealer.getTotal());
	}
	public static void printUserHand(Player user) {
		System.out.println("User hand: " + user.getHand().toString());
		System.out.println("Your current total: " + user.getTotal());
	}
	public static void printDealerHand(Player dealer) {
		System.out.println("Dealer hand: " + dealer.getHand().toString());
		System.out.println("Dealer's current total: " + dealer.getTotal());
	}

	public static void winCheck(Player user, Player dealer) {
		if (user.getTotal() > 21) {
			System.out.println("You busted, YOU LOSE!");
		} else if (dealer.getTotal() > 21) {
			System.out.println("Dealer busted, YOU WIN!");
		} else if (user.getTotal() > dealer.getTotal()) {
			System.out.println("You win!");
		} else if (user.getTotal() < dealer.getTotal()) {
			System.out.println("Dealer wins.");
		} else {
			if (user.getHand().size() < dealer.getHand().size()) {
				System.out.println("YOU WIN! You have the same score as the dealer, but in fewer cards.");
			} else if (user.getHand().size() > dealer.getHand().size()) {
				System.out.println("YOU LOSE. You have the same score as the dealer, but in more cards.");
			} else {
				System.out.println("DRAW. Not a draw!!");
			}
		}
	}
}
